#!/usr/bin/env bash

cd $HOME

mkdir -p .config/bat
ln -sf ~/dotfiles/misc-configs/bat/config .config/bat/config

mkdir -p .config/git-delta
ln -sf ~/dotfiles/misc-configs/git-delta/themes.gitconfig .config/git-delta/themes.gitconfig

mkdir -p .config/nvim
# -n: treat existing symlink to dir as file (ensures idempotent re-runs)
ln -sfn ~/dotfiles/lua .config/nvim/lua
ln -sf ~/dotfiles/init.lua .config/nvim/init.lua
ln -sf ~/dotfiles/lazy-lock.json .config/nvim/lazy-lock.json

mkdir -p .config/ghostty
ln -sf ~/dotfiles/misc-configs/ghostty/config .config/ghostty/config

mkdir -p .config/lazygit
ln -sf ~/dotfiles/misc-configs/lazygit/config.yml .config/lazygit/config.yml

ln -sf ~/dotfiles/gitignore_global .gitignore_global

mkdir -p .claude
ln -sfn ~/dotfiles/misc-configs/claude/skills .claude/skills
ln -sf ~/dotfiles/misc-configs/claude/statusline-command.sh .claude/statusline-command.sh
# Copied (not symlinked) because Claude Code modifies settings.json at runtime.
[[ -f .claude/settings.json ]] && cp .claude/settings.json ".claude/settings.$(date +%Y%m%d%H%M%S).json"
cp ~/dotfiles/misc-configs/claude/settings.json .claude/settings.json
ln -sf ~/dotfiles/misc-configs/claude/CLAUDE.md .claude/CLAUDE.md

ln -sf ~/dotfiles/misc-configs/starship/starship.toml .config/starship.toml

mkdir -p .config/yazi
ln -sf ~/dotfiles/misc-configs/yazi/yazi.toml .config/yazi/yazi.toml

# Useful dirs.
mkdir -p queue temp workspace

if [[ -z "$HAS_LOADED_CUSTOM_SCRIPTS" ]]; then
  echo '
if [[ -z "$HAS_LOADED_CUSTOM_SCRIPTS" ]]; then
  export HAS_LOADED_CUSTOM_SCRIPTS=1

  source ~/dotfiles/zsh/env_vars.zsh
  source ~/dotfiles/zsh/functions.zsh
  source ~/dotfiles/zsh/aliases.zsh
fi
  ' >> ~/.zshrc
fi
